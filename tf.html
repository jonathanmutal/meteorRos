<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />

<script type="text/javascript" src="http://cdn.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script>
<script type="text/javascript" src="http://cdn.robotwebtools.org/roslibjs/current/roslib.min.js"></script>


<script type="text/javascript" type="text/javascript">
  // Connecting to ROS
  // -----------------

  // Create a ros node object to communicate with a rosbridgeserver 2.0
  var ros = new ROSLIB.Ros({
    url : 'ws://localhost:9090'
  });

  ros.on('connection', function() {
    console.log('Connected to websocket server.');
  });

  ros.on('error', function(error) {
    console.log('Error connecting to websocket server: ', error);
  });

  ros.on('close', function() {
    console.log('Connection to websocket server closed.');
  });

  // topic for move the turtle
  var cmdVelTurtle = new ROSLIB.Topic({
    ros : ros,
    name : '/turtle1/cmd_vel',
    messageType : 'geometry_msgs/Twist'
  });

  // topic to know the position
  var position = new ROSLIB.Topic({
    ros : ros,
    name: '/turtle1/pose',
    messageType: 'turtlesim/Pose'
  });

  // wait for instruction
  var seg = 1000;

  // Initial position to send a message
  var twist = new ROSLIB.Message({
    linear : {
      x : 0.0,
      y : 0.0,
      z : 0.0
    },
    angular : {
      x : 0.0,
      y : 0.0,
      z : 0.0
    }
  });

  // turtle position
  var actualPosition = {
    x : 0.0,
    y : 0.0
  }


  // to know the actual position
  position.subscribe(function(pst) {
    if (actualPosition.x != pst.x || actualPosition.y != pst.y) {
      actualPosition.x = pst.x;
      actualPosition.y = pst.y;
      console.log(actualPosition);
    }
  });

  // draw a line
  line = function(linearx, angularz) {
    twist.linear.x = linearx;
    twist.angular.z = angularz;
    cmdVelTurtle.publish(twist);
  }


  // draw a star
  drawStar = function() {
    setTimeout(function(){
      line(0.0, 1.0);
    }, 1 * seg);
    setTimeout(function() {
      line(2.0, 0.0);
    }, 2 * seg);
    setTimeout(function(){
      line(0.0, -2.0)
    }, 3 * seg);
    setTimeout(function(){
      line(2.0, 0.0);
    }, 4 * seg);
    setTimeout(function(){
      line(0.0, -2.5);
    }, 5 * seg);
    setTimeout(function(){
      line(2.5, 0.0);
    }, 6 * seg);
    setTimeout(function(){
      line(0.0, -2.7);
    }, 7 * seg);
    setTimeout(function(){
      line(2.5, 0.0);
    }, 8 * seg);
    setTimeout(function(){
      line(0.0, -2.8);
    }, 9 * seg);
    setTimeout(function(){
        line(2.5, 0.0)
    }, 10 * seg);
  }

  // to draw a graphic using canvas
  drawGraphic = function(posx, posy) {
    var c = document.getElementById("myCanvas");
    var ctx = c.getContext("2d");

    ctx.beginPath();
    ctx.lineWidth = "5";
    ctx.strokeStyle = "black";
    ctx.moveTo(posx, posy);
    ctx.lineTo(1000, 0);
    ctx.stroke();

  }


</script>
<body>

  <canvas id="myCanvas" width="500px" height="500px" style="background-color:lightgrey;">
    Your browser does not support the HTML5 canvas tag.</canvas>
  </canvas>
  <button onclick="drawStar()">Draw</button>
</body>
</head>

</html>

